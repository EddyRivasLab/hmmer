Checklist for a HMMER release
SRE, Tue Mar 25 14:34:33 2008
--------------------------------------------------------
When editing this 00CHECKLIST, edit it in the trunk, not in a release
branch; it isn't included in releases anyway.

Subversion repository:  https://svn.janelia.org/eddylab/eddys/src/hmmer

HMMER follows an 'unstable trunk' policy.
Each major release goes onto a stable branch.
Every release (even minor ones) is tagged.

Release types: major releases, minor releases, and snapshots. A major
release gets its own branch. A minor release puts bug fixes into a
major branch. A snapshot is from the development trunk.

Version naming:                                        example
major    <lineage>.<major-release>                      3.0
minor    <lineage>.<major-release>.<minor-release>      3.0.1
alpha    <lineage>.<major-release>a<n>                  3.0a1 
beta     <lineage>.<major-release>b<n>                  3.0b3 
snapshot <lineage>.<major-release>.snap<yyyymmdd>       3.0.snap20080325


1. Announce intent to release to all developers. 
   Commit working copies on all machines.
   Check for stray uncommitted files:
	 ./configure
         make distclean
         svn update
	 svn status
   Clean up any stray files identified by 'svn status'.
   'svn add' and 'svn commit' as needed to commit new or modified files.







================================================================
= Creating a new major release branch, if necessary
================================================================

For major public releases (3.0, 3.1): we create a Subversion branch,
so we can continue support (with bugfixes) without disrupting
development of the next main release.


*  First test the development trunk.
   Compile should be entirely clean when compiled -Wall.
   'make check' should be clean.
   '(cd documentation/alphaguide; make)' should work

   When trunk is clean, 
   svn commit
   We're (usually) next going to move out of the trunk to the release branch.

*  Create stable release branch from the trunk.
   All subsequent bugfix releases will happen in this branch, while trunk keeps moving.

   svn copy https://svn.janelia.org/eddylab/eddys/src/hmmer/trunk\
            https://svn.janelia.org/eddylab/eddys/src/hmmer/branches/3.0\
            -m "created HMMER 3.0 release branch"          
   svn copy https://svn.janelia.org/eddylab/eddys/easel/trunk\
            https://svn.janelia.org/eddylab/eddys/easel/branches/hmmer/3.0\
            -m "created HMMER 3.0 release branch"          

   [or, svn merge from trunk to existing branch. Write these instructions next time.]



================================================================
= Stabilizing a release branch: a working copy in ~/releases/hmmer-release
================================================================

Once a release branch has been taken (either new, or by a merge from
the trunk destined to become a release), work only in the release
branch. We'll merge changes back to the trunk when the release cycle
is complete.

Put the directory in releases/

  cd ~/releases
  svn checkout https://svn.janelia.org/eddylab/eddys/src/hmmer/branches/3.0  hmmer-release
  
Don't call this working directory hmmer-3.0, nor hmmer! Call it
hmmer-release, because later "make dist" is going to try to create
hmmer-xx as its release, and because you want to recognize that it's
different from src/hmmer.

If this is the first time (a new release branch), you also need to
update the "svn:externals" so Easel is checked out from the
appropriate stable branch too.

  svn proplist --verbose https://svn.janelia.org/eddylab/eddys/src/hmmer/branches/3.0
  svn propedit svn:externals hmmer-release
     easel   https://svn.janelia.org/eddylab/eddys/easel/branches/hmmer/3.0
  cd hmmer-release
  svn update
  svn commit

Note the hassle with svn:externals, because it currently only accepts
absolute URLs. Relative paths are supposed to become available in
Subversion 1.5, which may help. Later when we merge the branch back to
the trunk, the merge will mess up easel's externals, and we'll have to
propedit the trunk.

Write the release notes in releases/.
  To gather information, check:

   HMMER bugs/BUGTRAX - update this file to mark release that fixed
                        bugs, and divider indicating release.
   Paper notebook since last release
   svn log since last release:
   svn log -r2837:HEAD https://svn.janelia.org/eddylab/eddys/src/hmmer/trunk
   svn log  -r350:HEAD https://svn.janelia.org/eddylab/eddys/easel/trunk

Check that the user guide is up to date.
Revise the tutorial section. See last ~/notebook entry for scripts.
Don't slack off on this step - it's a useful regression test as well.
  

Finally,
  make distclean
  svn status
do any cleanup... and
  svn commit
from the release directory

================================================================
= Creating a distribution
================================================================

${HMMER_VERSION} tag used below should match @HMMER_VERSION@ in configure.ac, Makefile


* You can put it in the environment and everything will work as cut/paste:
   setenv HMMER_VERSION  3.0b3
   cd ~/releases

* Delete any old releases of the same number
   rm -rf hmmer-${HMMER_VERSION}
   rm -f  hmmer-${HMMER_VERSION}.tar
   rm -f  hmmer-${HMMER_VERSION}.tar.gz

* Export a snapshot, alpha, beta, or release candidate from the development trunk: 
   svn export https://svn.janelia.org/eddylab/eddys/src/hmmer/trunk hmmer-${HMMER_VERSION}
   cd hmmer-${HMMER_VERSION}

  or: Export a major or minor release from its branch
   svn export https://svn.janelia.org/eddylab/eddys/src/hmmer/branches/3.0 hmmer-${HMMER_VERSION}
   cd hmmer-${HMMER_VERSION}

  3.0b3: exported 3051/442

* Edit configure.ac: make sure version, date, copyright info is set correctly
   emacs configure.ac
   ln -s easel/aclocal.m4 .
   autoconf; (cd easel; autoconf)
   ./configure
   source release-notes/LICENSE.csh

* Check that svn has file permissions right
   find . ! -perm -u+r -print
   find . -perm o+x ! -perm -u+x -print

* versioning, dating, licensing (these are originally set in configure.ac)
* must do Easel first

   easel/devkit/sedition EASEL_VERSION ${EASEL_VERSION} EASEL_DATE "${EASEL_DATE}" EASEL_COPYRIGHT "${EASEL_COPYRIGHT}" easel/00README
   easel/devkit/sedition EASEL_VERSION ${EASEL_VERSION} EASEL_DATE "${EASEL_DATE}" EASEL_COPYRIGHT "${EASEL_COPYRIGHT}" easel/COPYRIGHT
   easel/devkit/sedition EASEL_VERSION ${EASEL_VERSION} EASEL_DATE "${EASEL_DATE}" EASEL_COPYRIGHT "${EASEL_COPYRIGHT}" easel/INSTALL
   easel/devkit/sedition EASEL_VERSION ${EASEL_VERSION} EASEL_DATE "${EASEL_DATE}" EASEL_COPYRIGHT "${EASEL_COPYRIGHT}" easel/LICENSE.tag
   find easel -type f -exec easel/devkit/sedition-pp LICENSE easel/LICENSE.tag {} \;   

   easel/devkit/sedition HMMER_VERSION ${HMMER_VERSION} HMMER_DATE "${HMMER_DATE}" HMMER_COPYRIGHT "${HMMER_COPYRIGHT}" README
   easel/devkit/sedition HMMER_VERSION ${HMMER_VERSION} HMMER_DATE "${HMMER_DATE}" HMMER_COPYRIGHT "${HMMER_COPYRIGHT}" COPYRIGHT
   easel/devkit/sedition HMMER_VERSION ${HMMER_VERSION} HMMER_DATE "${HMMER_DATE}" HMMER_COPYRIGHT "${HMMER_COPYRIGHT}" INSTALL
   easel/devkit/sedition HMMER_VERSION ${HMMER_VERSION} HMMER_DATE "${HMMER_DATE}" HMMER_COPYRIGHT "${HMMER_COPYRIGHT}" release-notes/LICENSE.tag
   find .     -type f -exec easel/devkit/sedition-pp LICENSE release-notes/LICENSE.tag {} \;

* compile documentation
  Beta Guide:
   cd documentation/alphaguide
   make
   mv Userguide.pdf ../../Userguide.pdf
   cd ../..

  User Guide (not ready yet)
   cd documentation/userguide
   ln -s plan7-core.ai plan7-core.pdf
   ln -s plan7-search.ai  plan7-search.pdf
   make
   pdflatex main
   mv Userguide.pdf ../../
   cd ../..	 

* In Makefile.in, comment out Makefile and configure targets - 
  users may not have autoconf installed.


* compile Linux binaries with icc
  Each build can run in a separate terminal; we're using independent build directories

   ssh login-eddy
   setenv HMMER_VERSION  3.0b3
   source /usr/local/intel/current/bin/iccvars.csh intel64
   cd releases/hmmer-${HMMER_VERSION}
   source release-notes/LICENSE.csh
   mkdir build-x86_64
   cd    build-x86_64
   ../configure CC=icc LDFLAGS=-static-intel  --bindir=${HOME}/releases/hmmer-${HMMER_VERSION}/binaries/intel-linux-x86_64
   make
   make check
   make dev
   make install
   (cd easel/miniapps; make install)

 Building ia32 is a little tricky, because our environment is so thoroughly x86_64.
 First go to .cshrc and comment out the
   source /usr/local/INTEL.csh line
 Then:

   ssh login-eddy
   setenv HMMER_VERSION  3.0b3
   source /usr/local/intel/ictce/current/ictce/3.2.0.020/ictvars.csh
   source /usr/local/intel/ictce/current/cc/11.0.074/bin/ia32/idbvars.csh
   source /usr/local/intel/ictce/current/cc/11.0.074/bin/iccvars.csh ia32
   source /usr/local/intel/ictce/current/fc/11.0.074/bin/ifortvars.csh ia32
   source /usr/local/intel/ictce/current/itac/7.2.0.011/bin/itacvars.csh
   source /usr/local/intel/ictce/current/impi/3.2.0.011/bin64/mpivars.csh
   setenv INTEL_LICENSE_FILE 28518@b03u25.int.janelia.org
   cd releases/hmmer-${HMMER_VERSION}
   source release-notes/LICENSE.csh
   mkdir build-ia32
   cd    build-ia32
   ../configure CC=icc LDFLAGS=-static-intel --bindir=${HOME}/releases/hmmer-${HMMER_VERSION}/binaries/intel-linux-ia32
   make
   make check
   make dev
   make install
   (cd easel/miniapps; make install)


* clean up files that don't belong in the distro

   make distclean
   cp   release-notes/RELEASE-${HMMER_VERSION} RELEASE-NOTES
   rm -rf build-ia32   
   rm -rf build-ia32-debug
   rm -rf build-x86_64
   rm -rf contrib
   rm -rf release-notes
   rm -rf bugs

   rm -rf documentation

   cd easel
   rm -f  00CHECKLIST LICENSE.csh.in LICENSE.tag 
   rm -rf documentation
   cd ..

* record and finish release notes

   cat RELEASE-NOTES | dumpnotes
   emacs RELEASE-NOTES
   emacs ~/src/hmmer/release-notes/RELEASE-3.0b2
   texclean

* package

   cd ..
   tar cvf hmmer-${HMMER_VERSION}.tar hmmer-${HMMER_VERSION}
   gzip hmmer-${HMMER_VERSION}.tar

   3.0b3: 17.1 Mb

* test again
   cd hmmer-${HMMER_VERSION}
   ./configure
   make
   make dev
   make check

* copy to ftp site

   cd ~/releases
   scp hmmer-${HMMER_VERSION}.tar.gz        selab:/opt/www/ftp/pub/software/hmmer3/
   scp hmmer-${HMMER_VERSION}/RELEASE-NOTES selab:/opt/www/ftp/pub/software/hmmer3/
   scp hmmer-${HMMER_VERSION}/Userguide.pdf selab:/opt/www/ftp/pub/software/hmmer3/
   echo ftp://selab.janelia.org/pub/software/hmmer3/hmmer-${HMMER_VERSION}.tar.gz
   
   
* tag the release. Replace version # below!
   cd ~/releases/hmmer-release

   svn copy https://svn.janelia.org/eddylab/eddys/src/hmmer/branches/3.0\
            https://svn.janelia.org/eddylab/eddys/src/hmmer/tags/3.0b3\
            -m "tagged 3.0b3 release, from 3.0 branch"          
   svn copy https://svn.janelia.org/eddylab/eddys/easel/branches/hmmer/3.0\
            https://svn.janelia.org/eddylab/eddys/easel/tags/hmmer/3.0b3\
            -m "tagged Easel for HMMER 3.0b3 release, from HMMER 3.0 branch"          

* Merge the branch's changes back to the trunk

  HMMER: -r 3050:3051
  Easel: no changes

  cd ~/src/hmmer
  svn update
  svn merge -r 3050:3051 https://svn.janelia.org/eddylab/eddys/src/hmmer/branches/3.0
  
  This screws up the Easel externals on the trunk, so fix:
 
  svn propedit svn:externals .
    easel   https://svn.janelia.org/eddylab/eddys/easel/trunk

  svn commit

 
* Update the web site and the blog


   
   
Release history
---------------

Release           Date            SVN (HMMER/Easel)
----------------  -------------   -----------------
3.0.snap20080325  25 Mar 2008     r2370/r236
3.0.snap20080419  19 Apr 2008     r2398/r247
3.0.snap20081101   1 Nov 2008     r2620/r302
3.0a1             12 Jan 2009     r2699/r312
3.0a2             13 Mar 2009     r2744/r330
3.0b1             17 Jun 2009     r2831/r345
3.0b2             21 Jun 2009     r2837/r350
3.0b3             15 Nov 2009     r3051/r442