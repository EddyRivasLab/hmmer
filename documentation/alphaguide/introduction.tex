\section{Introduction}

This is a user's guide to the HMMER3 alpha test distribution. 

It really isn't meant for a new user. I will assume you are already
familiar with profile hidden Markov models (profile HMMs)
\citep{Krogh94,Eddy98,Durbin98}; with the previous version of HMMER
[HMMER2, \url{http://hmmer.org}]; with other popular biological
sequence comparison tools, such as BLAST \citep{Altschul97}; and with
running sequence analysis tools on a UNIX or UNIX-like command
line. If this isn't true of you, you should probably not be using the
HMMER3 code yet. Instead, you should wait for a later and more stable
version, when the user documentation will take less for granted.

\subsection{Design goals of HMMER3}

HMMER3's objective is to combine the power of probabilistic inference
with BLAST's speed. We aim to upgrade some of molecular biology's most
important sequence analysis applications to use more powerful
statistical inference engines, while not sacrificing computational
performance.

Specifically, HMMER3 has three main design features that, in
combination, distinguish it from previous tools:

\begin{description}
\item[\textbf{Explicit representation of alignment uncertainty.}]
  Most sequence alignment analysis tools report only a single
  best-scoring alignment. However, sequence alignments are uncertain,
  and the more distantly related sequences are, the more uncertain
  alignments become. HMMER3 calculates complete posterior alignment
  ensembles rather than single optimal alignments. Posterior ensembles
  get used for a variety of useful inferences involving alignment
  uncertainty. For example, any HMMER3 sequence alignment is
  accompanied by posterior probability annotation, representing the
  degree of confidence in each individual aligned residue.

\item[\textbf{Sequence scores, not alignment scores.}]  Alignment
  uncertainty has an important impact on the power of sequence
  database searches.  It's precisely the most remote homologs -- the
  most difficult to identify and potentially most interesting
  sequences -- where alignment uncertainty is greatest, and where the
  statistical approximation inherent in scoring just a single best
  alignment breaks down the most. To maximize power to discriminate
  true homologs from nonhomologs in a database search, statistical
  inference theory says you ought to be scoring sequences by
  integrating over alignment uncertainty, not just scoring the single
  best alignment. HMMER3's log-odds scores are sequence scores, not
  just optimal alignment scores, integrated over the posterior
  alignment ensemble.
  
\item[\textbf{Speed.}] A major limitation of previous profile HMM
  implementations (including HMMER2) was their slow
  performance. HMMER3 implements a new heuristic acceleration
  algorithm. For most queries, it's about as fast as BLAST.
\end{description}

Individually, none of these points is new. As far as alignment
ensembles and sequence scores go, pretty much the whole reason why
hidden Markov models are so theoretically attractive for sequence
analysis is that they are good probabilistic models for explicitly
dealing with alignment uncertainty. The SAM profile HMM software from
UC Santa Cruz has always used full probabilistic inference (the HMM
``Forward'' and ``Backward'' algorithms) as opposed to optimal
alignment scores (the HMM ``Viterbi'' algorithm). HMMER2 had the full
HMM inference algorithms available as command-line options, but used
Viterbi alignment by default, in part for speed reasons. Calculating
alignment ensembles is even more computationally intensive than
calculating single optimal alignments.

One reason why it's been hard to deploy sequence scores for practical
large-scale use is that we haven't known how to accurately calculate
the statistical significance of a log-odds score that's been
integrated over alignment uncertainty. Accurate statistical
significance estimates are essential when one is trying to
discriminate homologs from millions of unrelated sequences in a large
sequence database search. The statistical significance of optimal
alignment scores can be calculated by Karlin/Altschul statistics
\citep{Karlin90,KarlinAltschul93}. Karlin/Altschul statistics are one
of the most important and fundamental advances introduced by BLAST.
However, this theory doesn't apply to integrated log-odds sequence
scores (HMM ``Forward scores'').  The statistical significance
(expectation values, or E-values) of HMMER3 sequence scores is
determined by using recent theoretical conjectures about the
statistical properties of integrated log-odds scores which have been
supported by numerical simulation experiments \citep{Eddy08}.

And as far as speed goes, there's really nothing new about HMMER3's
speed either. Besides Karlin/Altschul statistics, the other big reason
BLAST has been so useful is that it's so fast.  Our design goal in
HMMER3 was to achieve rough speed parity between BLAST and more formal
and powerful HMM-based methods.  The acceleration algorithm in HMMER3
is a new heuristic. It seems likely to be more sensitive than BLAST's
heuristics on theoretical grounds, and it certainly benchmarks that
way in practice (Eddy, 2009, manuscript in preparation). Additionally,
it's very well suited to modern hardware architectures. We expect to
be able to take good advantage of GPUs and other parallel processing
environments in the near future.



\subsection{What made it into the HMMER3.0 alpha test code}

\begin{tabular}{ll}
\multicolumn{2}{c}{\textbf{Single sequence queries: new to HMMER3}} \\ 
 & \\ 
\textbf{phmmer}    & Search a sequence against a sequence database. (BLASTP-like) \\
 & \\ 
\multicolumn{2}{c}{\textbf{Replacements for HMMER2's functionality}}  \\
 & \\ 
\textbf{hmmbuild}  & Build a profile HMM from an input multiple alignment.\\
\textbf{hmmsearch} & Search a profile HMM against a sequence database.\\
\textbf{hmmscan}   & Search a sequence against a profile HMM database.\\
\textbf{hmmalign}  & Make a multiple alignment of many sequences to a common profile HMM.\\
 & \\ 
\multicolumn{2}{c}{\textbf{Other utilities}}\\ 
 & \\ 
\textbf{hmmconvert} & Convert profile formats to/from HMMER3 format.\\ 
\textbf{hmmemit}    & Generate (sample) sequences from a profile HMM.\\
\textbf{hmmfetch}   & Get a profile HMM by name or accession from an HMM database.\\
\textbf{hmmpress}   & Format an HMM database into a binary format for \prog{hmmscan}.\\
\textbf{hmmstat}    & Show summary statistics for each profile in an HMM database.\\ 
\end{tabular} \\
\\

The quadrumvirate of \prog{hmmbuild/hmmsearch/hmmscan/hmmalign} is
supposed to suffice to replace HMMER2's core functionality of
\prog{hmmbuild/hmmsearch/hmmpfam/hmmalign} in people's domain analysis
and annotation pipelines, for instance using profile databases like
Pfam or SMART. These four programs have already been subjected to some
serious independent testing by Rob Finn of the Pfam Consortium, who is
visiting at Janelia for several months, preparing to adopt HMMER3 at
Pfam, apparently by beating the living tar out of it. I haven't yet
fixed all the issues the evil Rob has identified, but I have fixed
the showstopping bugs.\footnote{I think.}

The \prog{phmmer} program is new to HMMER3. It searches a single
sequence against a sequence database, akin to BLASTP. (Internally, it
just produces a profile HMM from the query sequence, then runs an HMM
search.) An additional program, \prog{jackhmmer}, has narrowly missed
being supported as part of the initial alpha test release; there's
still some final work to do there. \prog{jackhmmer} is an iterative
sequence search program, essentially like \prog{PSI-BLAST}. 

In the Tutorial section, I'll show examples of running each of these
programs, using examples in the \ccode{tutorial/} subdirectory of the
distribution.




\subsection{What's still missing}

Oh, lots. The most egregious lacunae include:

\textbf{More parallelization.} HMMER3 is designed to be parallelized
at three levels: SIMD vector instructions within the CPU,
multithreaded (probably using OpenMP) across processor cores, and MPI
across individual nodes of a cluster. Relatively little of this
potential has been realized. The SIMD parallelization is part of
what's scientifically new and perhaps most interesting in HMMER3,
because SIMD parallelization is at the heart of the new acceleration
algorithm. However, for now HMMER's new SIMD ``MSV'' algorithm is
implemented only for Intel x86 compatible architectures. We will port
it to other SIMD vector architectures soon. No multithreading is
implemented yet; and MPI parallelization is only implemented in
\prog{hmmbuild}.

\textbf{More processor support.} One of the attractive features of the
MSV algorithm is that it is a very tight and efficient piece of code,
which ought to be able to take advantage of recent advances in using
massively parallel GPUs (graphics processing units), and other
specialized processors such as the Cell processor, or FPGAs. We have
prototype work going on in a variety of processors, but none of this
is far along as yet. But this work (combined with the parallelization)
is partly why we expect to wring significant more speed out of HMMER
in the future.

\textbf{More speed.} Even on x86 platforms, HMMER3's acceleration
algorithms are still on a nicely sloping bit of their asymptotic
optimization curve. I still think I can accelerate the code by another
two-fold or so. Additionally, for a small number of HMMs ($<1$\% of
Pfam models), the acceleration core is performing relatively poorly,
for reasons I pretty much understand (having to do with biased
composition; most of these pesky models are hydrophobic membrane
proteins), but which are nontrivial to work around. This'll produce an
annoying behavior that some testers are sure to notice: if you look
systematically, sometimes you'll see a model that runs at something
more like HMMER2 speed, 100x or so slower than an average query. This,
needless to say, Will Be Fixed.

\textbf{DNA sequence comparison.} HMMER's search pipeline is somewhat
specialized to protein/protein comparison: specifically, the pipeline
works by filtering individual sequences, winnowing down to a subset of
the sequences in a database that need close attention from the full
heavy artillery of Bayesian inference. This strategy doesn't work for
long DNA sequences; it doesn't filter the human genome much to say
``there's a hit on chromosome 1''. The algorithms need to be adapted
to identify high-scoring regions of a target sequence, rather than
filtering by whole sequence scores. (You can chop a DNA sequence into
overlapping windows and HMMER3 would work fine on such a chopped-up
database, but that's a disgusting kludge and I don't want to know
about it.)

\textbf{Translated comparisons.} We'd of course love to have the HMM
equivalents of BLASTX, TBLASTN, and TBLASTX. They'll come.

\textbf{More sequence input formats.} HMMER3 will work fine with FASTA
files for unaligned sequences, and Stockholm files for multiple
sequence alignments. It has parsers for a handful of other formats
(Genbank, EMBL, and Uniprot flatfiles; SELEX format alignments) that
we've tested somewhat. It's particularly missing parsers for some
widely used alignment formats such as Clustal format, so using HMMER3
on the MSAs produced by many popular multiple alignment programs
(MUSCLE or MAFFT for example) is harder than it should be, because it
requires a reformat to Stockholm format.

\textbf{More alignment modes.} HMMER3 \emph{only} does local
alignment. HMMER2 also could do glocal alignment (align a complete
model to a subsequence of the target) and global alignment (align a
complete model to a complete target sequence). The E-value statistics
of glocal and global alignment remain poorly understood. HMMER3 relies
on accurate significance statistics, far more so than HMMER2 did,
because HMMER3's acceleration pipeline works by filtering out
sequences with poor P-values.

\begin{sidebar}
Part of the reason for the alpha test is to confirm that these points
are just as annoying to you as they are to me, and therefore important
to fix asap. Feel free to tell me you want these things even though I
already know about them. I also want to find out what glaring problems
you find that I'm \emph{not} already losing sleep over. (Really.)
\end{sidebar}



\subsection{What I hope to accomplish in alpha test}

The core of HMMER3's functionality seems stable to me, but all the
stuff wrapped around it -- the stuff \emph{you} see, like the
applications, command line options, i/o formats -- is prototypical and
still fluid.  The main objective of the alpha test period is for a
small number of savvy power users to have the opportunity to give
feedback while the user-oriented layers of HMMER3 are still under
development -- in particular, before its basic feature set, command
line options, and input and output formats get frozen. You might want
it to spit out XML, or you like tab-delimited format, or you want this
number or that number on such-and-such a line to make it really fit in
your analysis pipeline, or you really really need a command line
option for slowing the search programs back down to HMMER2 speed so
you have more time for coffee\footnote{Actually, this option already
exists: \prog{--max}.}. This is the kind of stuff I'd most like to
hear now while the code is still fluid.

\begin{sidebar}
An obvious corollary of this responsiveness to your feedback is,
\textbf{don't write any heavy duty output parsers around HMMER3 just
yet.} You should expect all the output formats to change, at least
slightly, before a public release is finalized.
\end{sidebar}

Of course, since it's alpha test code, I'd like to also hear about
bugs: how you manage to break it, or when it produces inconsistent,
wrong, or confusing results, or when it doesn't compile or run at all.
Some bugs, I already know about, but I'd still like to hear about them
just to know you care.

\emph{Cryptogenomicon} (\url{http://cryptogenomicon.org/}) is a blog
where I'll be talking about issues as they arise in HMMER3, and where
you can comment or follow the discussion.





















  









