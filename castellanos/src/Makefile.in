# Makefile for HMMER src directory
#
# SRE, Mon Jan  1 19:05:39 2007 [Casa de Gatos]
# SVN $Id$

CC       = @CC@
CFLAGS   = @CFLAGS@
SIMDFLAGS= @SIMD_CFLAGS@
CPPFLAGS = @CPPFLAGS@
LDFLAGS  = @LDFLAGS@
DEFS     = @DEFS@
LIBS     = @LIBS@ -lm

AR       = @AR@ rcv 
RANLIB   = @RANLIB@

# Configuration for optional pthreads multiprocessor support
#
PTHREAD_LIBS   = @PTHREAD_LIBS@
PTHREAD_CFLAGS = @PTHREAD_CFLAGS@
MPILIBS        = @MPILIBS@

SHELL     = /bin/sh
MYLIBS    = -lhmmer -leasel 
MYLIBDIRS = -L../easel -L.
MYINCDIRS = -I../easel -I.
IMPLDIR   = impl_@IMPL_CHOICE@

PROGS = hmmbuild\
	hmmemit\
	hmmfetch\
	hmmsearch\
	hmmsim\
	hmmstat

HDRS =  hmmer.h\
	p7_config.h

OBJS =  build.o\
	emit.o\
	errors.o\
	evalues.o\
	eweight.o\
	generic_decoding.o\
	generic_fwdback.o\
	generic_null2.o\
	generic_msv.o\
	generic_optacc.o\
	generic_stotrace.o\
	generic_viterbi.o\
	generic_vtrace.o\
	heatmap.o\
	hmmer.o\
	logsum.o\
	modelconfig.o\
	modelstats.o\
	mpisupport.o\
	seqmodel.o\
	p7_alidisplay.o\
	p7_bg.o\
	p7_domaindef.o\
	p7_gmx.o\
	p7_hmm.o\
	p7_hmmfile.o\
	p7_prior.o\
	p7_profile.o\
	p7_spensemble.o\
	p7_tophits.o\
	p7_trace.o
#	island.o\

BENCHMARKS = \
	generic_decoding_benchmark\
	generic_fwdback_benchmark\
	generic_msv_benchmark\
	generic_null2_benchmark\
	generic_optacc_benchmark\
	generic_stotrace_benchmark\
	generic_viterbi_benchmark

UTESTS =\
	build_utest\
	generic_fwdback_utest\
	generic_msv_utest\
	generic_stotrace_utest\
	generic_viterbi_utest\
	logsum_utest\
	modelconfig_utest\
	p7_hmm_utest\
	p7_hmmfile_utest\
	p7_profile_utest\
	p7_tophits_utest

EXAMPLES = \
	generic_fwdback_example\
	generic_msv_example\
	generic_optacc_example\
	generic_stotrace_example\
	generic_viterbi_example\
	generic_vtrace_example


all: 	${PROGS}

check:  ${PROGS} ${UTESTS}

dev:    ${PROGS} ${UTESTS} ${BENCHMARKS} ${EXAMPLES}
	cd ${IMPLDIR}; ${MAKE} dev

${PROGS}: @EXEC_DEPENDENCY@  libhmmer.a ../easel/libeasel.a
	${CC} ${CFLAGS} ${PTHREAD_CFLAGS} ${DEFS} ${LDFLAGS} ${MYLIBDIRS} ${PVMLIBDIR} -o $@ $@.o ${PVMLIBS} ${MYLIBS} ${PTHREAD_LIBS} ${MPILIBS} ${LIBS}

${UTESTS}: libhmmer.a ../easel/libeasel.a
	@ echo "Compiling $@ ..."
	@BASENAME=`echo $@ | sed -e 's/_utest//' | sed -e 's/^p7_//'` ;\
	DFLAG=`echo $${BASENAME} | sed -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`;\
	DFLAG=p7$${DFLAG}_TESTDRIVE ;\
	if test -e p7_$${BASENAME}.c; then \
           DFILE=p7_$${BASENAME}.c ;\
        else \
           DFILE=$${BASENAME}.c ;\
	fi;\
	${CC} ${CFLAGS} ${SIMDFLAGS} ${CPPFLAGS} ${LDFLAGS} ${DEFS} ${MYLIBDIRS} ${MYINCDIRS} -D$${DFLAG} -o $@ $${DFILE} ${MYLIBS} ${LIBS}

${BENCHMARKS}: libhmmer.a ../easel/libeasel.a
	@ echo "Compiling $@ ..."
	@BASENAME=`echo $@ | sed -e 's/_benchmark//' | sed -e 's/^p7_//'` ;\
	DFLAG=`echo $${BASENAME} | sed -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`;\
	DFLAG=p7$${DFLAG}_BENCHMARK ;\
	if test -e p7_$${BASENAME}.c; then \
           DFILE=p7_$${BASENAME}.c ;\
        else \
           DFILE=$${BASENAME}.c ;\
	fi;\
	${CC} ${CFLAGS} ${SIMDFLAGS} ${CPPFLAGS} ${LDFLAGS} ${DEFS} ${MYLIBDIRS} ${MYINCDIRS} -D$${DFLAG} -o $@ $${DFILE} ${MYLIBS} ${LIBS}

${EXAMPLES}: libhmmer.a ../easel/libeasel.a
	@ echo "Compiling $@ ..."
	@BASENAME=`echo $@ | sed -e 's/_example//' | sed -e 's/^p7_//'` ;\
	DFLAG=`echo $${BASENAME} | sed -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`;\
	DFLAG=p7$${DFLAG}_EXAMPLE ;\
	if test -e p7_$${BASENAME}.c; then \
           DFILE=p7_$${BASENAME}.c ;\
        else \
           DFILE=$${BASENAME}.c ;\
	fi;\
	${CC} ${CFLAGS} ${SIMDFLAGS} ${CPPFLAGS} ${LDFLAGS} ${DEFS} ${MYLIBDIRS} ${MYINCDIRS} -D$${DFLAG} -o $@ $${DFILE} ${MYLIBS} ${LIBS}

libhmmer.a: ${HDRS} ${OBJS} impl_obj
	$(AR) libhmmer.a ${OBJS}
	$(RANLIB) libhmmer.a
	chmod 644 libhmmer.a

../easel/libeasel.a: 
	cd ../easel; ${MAKE} libeasel.a

impl_obj:
	cd ${IMPLDIR}; make

.c.o:
	${CC} ${CFLAGS} ${SIMDFLAGS} ${CPPFLAGS} ${DEFS} ${PTHREAD_CFLAGS} ${MYINCDIRS} ${PVMINCDIR} -c $<


distclean:
	-rm -f *.o *~ Makefile.bak core ${PROGS} TAGS gmon.out libhmmer.a
	-rm -f ${UTESTS}
	-rm -f ${BENCHMARKS}
	-rm -f ${EXAMPLES}
	-rm -f *.gcno
	-rm -f Makefile p7_config.h
	cd  ${IMPLDIR}; make distclean

clean:
	-rm -f *.o *~ Makefile.bak core ${PROGS} TAGS gmon.out libhmmer.a
	-rm -f ${UTESTS}
	-rm -f ${BENCHMARKS}
	-rm -f ${EXAMPLES}
	-rm -f *.gcno
	cd ${IMPLDIR}; make clean

binclean:
	-rm -f *.o *~ Makefile.bak core TAGS gmon.out libhmmer.a
	cd ${IMPLDIR}; make binclean

tags:
	etags  *.c *.h Makefile.in
	etags -a impl_sse/*.c impl_sse/*.h impl_sse/Makefile.in
	etags -a impl_vmx/*.c impl_vmx/*.h impl_vmx/Makefile.in

###########
# @LICENSE@
###########
