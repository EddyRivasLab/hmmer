Checklist for a HMMER distribution.

1. Make sure we're up to date w/ Subversion. (Worry about commits here, on
   other machines and other dirs that may have squid modifications)
	% ./configure
        % make distclean
	% svn status
   Clean up any stray files; svn commit any modifications.

2. Test dev code before making release.
   This works anywhere (e.g. wren; don't have to be on wrasse)
   With and without memory leak tests ('make check' doesn't include -m flag)
   ccmalloc 0.3.9 is installed in /usr/local on wren and wrasse.
   Note: ccmalloc not threadsafe, so this doesn't test threads implementation.
   Note: glibc qsort() has a 6-byte "leak": tophits test will leak 6 bytes and fail.
    	% autoconf; (cd squid; autoconf)
     	% ./configure --enable-ccmalloc --enable-debugging
        % make
	% (cd testsuite; ../ssdk/sqc -m -p ../squid 2 exercises.sqc . ../src)
	% (cd Bugs;      ../ssdk/sqc -m -p ../squid 2 bugs.sqc      . ../src)
   Capture copies of the ccmalloc-instrumented binaries, if you want
   to do manual testing with them.	
	% make distclean
	% ./configure --enable-threads --enable-lfs --enable-pvm
	% make
	% make check
        % (cd Bugs;      ../ssdk/sqc -p ../squid 2 bugs.sqc      . ../src)
	% make optcheck

3. More manual testing.
     Test the pvm (wrasse):
        % ssh-add
        % cd testsuite
	% pvm pvm.conf
             conf
             quit
	% time ../src/hmmscan --pvm Pfam_ls ../tutorial/7LES_DROME > foo.pvm
	% echo halt| pvm 
     Test threads and nonthreads (whelk01): 
        % time ../src/hmmscan Pfam_ls ../tutorial/7LES_DROME > foo.pthread
        % time ../src/hmmscan --cpu 0 Pfam_ls ../tutorial/7LES_DROME > foo.normal
     Make sure that foo.* all work (7LES_DROME is big enough to exercise bug #h22)
     Check that foo.* all give identical E-values (bug #h20).
        % diff foo.normal foo.pvm
        % diff foo.normal foo.pthread
	% rm foo.*
	
     [2.4dev1 wall times: pvm = 48.95s; pthread=4:21.22; normal=13:47.05

     [TODO: Add tests for swissprot searches, w/ and w/o ccmalloc instrumentation;
      test for bug #h25]

4. Write release notes.
   cvs2cl.pl creates ChangeLog; a useful summary of CVS logs
	% ssdk/cvs2cl.pl    
        % emacs Release-Notes/RELEASE-${RELEASE}
	% cvs add Release-Notes/RELEASE-${RELEASE}

5. Update copyright, year, relcode, etc:
        configure.ac
	Licenses/gnu   (year only)

6. Commit to CVS. Include package and release # in the log message.
	% cvs commit

7. Make a distro. 
   yes, you have to autoconf and make a new configure script; you
   just updated the info in configure.ac, remember?
	% make distclean
	% autoconf; (cd squid; autoconf); ./configure
	% make dist
	

8. Create the binary distributions, on w001, the compile farm master node.
   Check the buildall script - make sure passwordless ssh works for
   each machine in the compile farm.
         ssh w001
	 eval `ssh-agent`; ssh-add
         mkdir hmmer-2.3.2; cd hmmer-2.3.2
         ln -s /nfs/wol2/people/eddy/src/hmmer/ssdk/nodebuild .
         ln -s /nfs/wol2/people/eddy/src/hmmer/ssdk/rootbuild .
         ln -s /nfs/wol2/people/eddy/src/hmmer/ssdk/buildall .
         ln -s /nfs/wol2/people/eddy/src/hmmer/hmmer-2.3.2.tar.gz .
         ./buildall hmmer-2.3.2 >& build.log &
         tail -f build.log

    darwin (g4it-1) is done manually:
   	note that xlc does not appear to support Altivec. Use OS/X cc.
    ssh into dual800 in Warren's lab.
	ssh species.wustl.edu -l seddy
	ssh g4it-1

      scp eddy@genetics.wustl.edu:src/hmmer/hmmer-2.3.2.tar.gz .
      scp eddy@genetics.wustl.edu:src/hmmer/ssdk/nodebuild .
      ./nodebuild /home/seddy hmmer-2.3.2  powerpc-apple-osx "--enable-threads --enable-lfs --enable-altivec" CC=cc CFLAGS="-O" 
      scp hmmer-2.3.2.bin.powerpc-apple-osx.tar.gz eddy@genetics.wustl.edu:
      scp hmmer-2.3.2.powerpc-apple-osx.log eddy@genetics.wustl.edu:

      tar zxf hmmer-2.3.1.bin.powerpc-apple-osx.tar.gz
      cd hmmer-2.3.1.bin.powerpc-apple-osx
      [cpu0/pkinase/50000 =  513.270u  w/o altivec]
      [cpu0/pkinase/50000 =  177.360u 2:58.04   w/  altivec]
      [cpu2/pkinase/50000 =  206.610u 1:44.90   w/  altivec]
      
    manual build of alpha-tru64.
      	ssh waterbug
  	cd /tmp
	cp ~/src/hmmer/ssdk/nodebuild .
	cp ~/src/hmmer/hmmer-2.3.2.tar.gz .
	./nodebuild /tmp hmmer-2.3.2 alpha-tru64 "--enable-threads --enable-lfs" CC=cc CFLAGS=-O
	cp hmmer-2.3.2.alpha-tru64.log hmmer-2.3.2.bin.alpha-tru64.tar.gz ~/notebook/1003-hmmer-2.3.2-release/
 	
    manual build of ia64-hp-hpux on whelk05
	ssh w001
        cd hmmer-2.3.2
        (test ssh to whelk05)
       	./rootbuild whelk05   /tmp hmmer-2.3.2 ia64-hp-hpux "--enable-threads --enable-lfs"  CC=cc CFLAGS="-O"

    manual build of sun-solaris.
      	ssh whidder
  	cd /tmp
	cp ~/src/hmmer/ssdk/nodebuild .
	cp ~/src/hmmer/hmmer-2.3.2.tar.gz .
	./nodebuild /tmp hmmer-2.3.2 sun-solaris "--enable-threads --enable-lfs" CC=cc CFLAGS=-O2
	cp hmmer-2.3.2.sun-solaris.log hmmer-2.3.2.bin.sun-solaris.tar.gz ~/notebook/1003-hmmer-2.3.2-release/

    whippet is also done manually. NFS is fucked up?
      ssh whippet
      cd /scratch/eddy
      ftp genetics
         ~/src/hmmer/hmmer-2.3.1.tar.gz 
         ~/src/hmmer/ssdk/nodebuild .
      ./nodebuild /scratch/eddy hmmer-2.3.1  hp-hpux "--enable-threads" CFLAGS="-O"
      cp hmmer-2.3.bin.hp-hpux.tar.gz ~/
      cp hmmer-2.3.hp-hpux.log ~/

    Collect all binary distros in a notebook/ page.

    Check the logs:
	emacs *.log	

    Copy all binary distros to the FTP site,
    /nfs/ftp/eddy/hmmer/(RELEASE)/
           mkdir /nfs/ftp/eddy/hmmer/2.3.2
           cp *.tar.gz /nfs/ftp/eddy/hmmer/2.3.2/

9.  Install all the files on the FTP site; change CURRENT symlink.
    (Check that FTPDIR is correct in Makefile).

      % make ftpdist
      % make stable

10. Update and install the web page, which is in ~/web/hmmer.

      % make install

11. Email hmmer@genetics.wustl.edu and make the announcement.

12. Commit again, after a successful release:
	% cvs commit
