############################################################
# Makefile for HMMER src directory
#
# SRE, Mon Jan  1 19:05:39 2007 [Casa de Gatos]
# SVN $Id$
#


## your compiler and compiler flags
#
CC       = @CC@
CFLAGS   = @CFLAGS@
SIMDFLAGS= @SIMD_CFLAGS@
CPPFLAGS = @CPPFLAGS@
LDFLAGS  = @LDFLAGS@
DEFS     = @DEFS@
LIBS     = @LIBS@ -lm

## archiving command, and ranlib command if you need one.
#  In general, you shouldn't need to change these, and they're
#  only used for building the testsuite anyway... e.g. we
#  make a "libhmmer.a" library for building the testsuite.
#
AR     = @AR@ rcv 
RANLIB = @RANLIB@

# Configuration for optional pthreads multiprocessor support
#
PTHREAD_LIBS   = @PTHREAD_LIBS@
PTHREAD_CFLAGS = @PTHREAD_CFLAGS@

MPILIBS   = @MPILIBS@

SHELL    = /bin/sh
MYLIBS   = -leasel
MYLIBDIR = -L../easel
MYINCDIR = -I. -I../easel

PROGS = hmmbuild hmmemit hmmfetch hmmsearch hmmsim hmmstat

OBJS =  build.o\
	dp_generic.o\
	dp_optaccuracy.o\
	emit.o\
	errors.o\
	evalues.o\
	eweight.o\
	heatmap.o\
	hmmer.o\
	logsum.o\
	modelconfig.o\
	modelstats.o\
	mpisupport.o\
	null2.o\
	seqmodel.o\
	p7_alidisplay.o\
	p7_bg.o\
	p7_domaindef.o\
	p7_gmx.o\
	p7_hmm.o\
	p7_hmmfile.o\
	p7_prior.o\
	p7_profile.o\
	p7_spensemble.o\
	p7_tophits.o\
	p7_trace.o
#	island.o\

HDRS =  hmmer.h\
	p7_config.h

IMPLDIR  = impl_@IMPL_CHOICE@

IMPL_OBJ =\
	${IMPLDIR}/p7_omx.o\
	${IMPLDIR}/p7_oprofile.o

IMPL_HEADER = ${IMPLDIR}/impl_${IMPL_CHOICE}.h

.c.o:
	${CC} ${CFLAGS} ${SIMDFLAGS} ${CPPFLAGS} ${DEFS} ${PTHREAD_CFLAGS} ${MYINCDIR} ${PVMINCDIR} -c $<


#################################################################
## Targets defining how to make HMMER executables.
##
all: 	${PROGS} libhmmer.a  ../easel/libeasel.a

${IMPL_OBJ}: 
	cd ${IMPLDIR}; make

${PROGS}: @EXEC_DEPENDENCY@ ${OBJS} ${IMPL_OBJ}  libhmmer.a ../easel/libeasel.a
	${CC} ${CFLAGS} ${PTHREAD_CFLAGS} ${DEFS} ${LDFLAGS} ${MYLIBDIR} ${PVMLIBDIR} -o $@ $@.o ${OBJS} ${IMPL_OBJ} ${PVMLIBS} ${MYLIBS} ${PTHREAD_LIBS} ${MPILIBS} ${LIBS}

#################################################################
## Targets used in making HMMER library for testsuite compilation.
##
module: libhmmer.a

libhmmer.a: ${OBJS} ${IMPL_OBJ}
	$(AR) libhmmer.a ${OBJS} ${IMPL_OBJ}
	$(RANLIB) libhmmer.a
	chmod 644 libhmmer.a


#################################################################
## Miscellaneous targets.
##
check:
	(cd testsuite; ./sqc 2 testsuite.sqc .)

distclean:
	-rm -f *.o *~ Makefile.bak core ${PROGS} TAGS gmon.out libhmmer.a
	-rm -f *.gcno
	-rm -f Makefile p7_config.h
	cd impl_sse; make distclean
	cd impl_vmx; make distclean

clean:
	-rm -f *.o *~ Makefile.bak core ${PROGS} TAGS gmon.out libhmmer.a
	-rm -f *.gcno
	cd impl_sse; make clean
	cd impl_vmx; make clean

binclean:
	-rm -f *.o *~ Makefile.bak core TAGS gmon.out libhmmer.a
	cd impl_sse; make binclean
	cd impl_vmx; make binclean

TAGS:
	etags  *.c *.h Makefile.in
	etags -a impl_sse/*.c impl_sse/*.h impl_sse/Makefile.in
	etags -a impl_vmx/*.c impl_vmx/*.h impl_vmx/Makefile.in

###########
# @LICENSE@
###########
