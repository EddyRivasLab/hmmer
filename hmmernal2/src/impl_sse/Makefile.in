# HMMER SSE optimized implementation
#
# SRE, Wed Jul 30 10:49:13 2008 [Janelia]
# SVN $Id$

CC             = @CC@
CFLAGS         = @CFLAGS@
SIMDFLAGS      = @SIMD_CFLAGS@
CPPFLAGS       = @CPPFLAGS@
LDFLAGS        = @LDFLAGS@
DEFS           = @DEFS@
LIBS           = @LIBS@ -lm
AR             = @AR@ rcv
RANLIB         = @RANLIB@

SHELL          = /bin/sh
MYLIBS         = -lhmmer -leasel -lm
MYLIBDIRS      = -L../../../easel -L..
MYINCDIRS      = -I../../../easel -I..

OBJS =  decoding.o\
	fwdback.o\
	null2.o\
	optacc.o\
	msvfilter.o\
	stotrace.o\
	vitfilter.o\
	vitscore.o\
	p7_omx.o\
	p7_oprofile.o

HDRS =  impl_sse.h

UTESTS = \
	fwdback_utest\
	msvfilter_utest\
	optacc_utest\
	stotrace_utest\
	vitfilter_utest\
	vitscore_utest

BENCHMARKS =\
	decoding_benchmark\
	fwdback_benchmark\
	msvfilter_benchmark\
	null2_benchmark\
	optacc_benchmark\
	stotrace_benchmark\
	vitfilter_benchmark\
	vitscore_benchmark

EXAMPLES =\
	fwdback_example\
	msvfilter_example\
	optacc_example\
	stotrace_example\
	vitfilter_example\
	vitscore_example

all: 	   ${HDRS} ${OBJS}

check:     ${UTESTS}

dev:       ${UTESTS} ${BENCHMARKS} ${EXAMPLES}

${UTESTS}: ../libhmmer.a ../../easel/libeasel.a 
	@ echo "Compiling $@"
	@BASENAME=`echo $@ | sed -e 's/_utest//'` ;\
	DFLAG=`echo $${BASENAME} | sed -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`;\
	DFLAG=p7$${DFLAG}_TESTDRIVE ;\
	DFILE=$${BASENAME}.c ;\
	${CC} ${CFLAGS} ${SIMDFLAGS} ${CPPFLAGS} ${LDFLAGS} ${DEFS} ${MYLIBDIRS} ${MYINCDIRS} -D$${DFLAG} -o $@ $${DFILE} ${MYLIBS}

${BENCHMARKS}: ../libhmmer.a ../../easel/libeasel.a
	@ echo "Compiling $@"
	@BASENAME=`echo $@ | sed -e 's/_benchmark//'` ;\
	DFLAG=`echo $${BASENAME} | sed -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`;\
	DFLAG=p7$${DFLAG}_BENCHMARK ;\
	DFILE=$${BASENAME}.c ;\
	${CC} ${CFLAGS} ${SIMDFLAGS} ${CPPFLAGS} ${LDFLAGS} ${DEFS} ${MYLIBDIRS} ${MYINCDIRS} -D$${DFLAG} -o $@ $${DFILE} ${MYLIBS}

${EXAMPLES}: ../libhmmer.a ../../easel/libeasel.a 
	@ echo "Compiling $@"
	@BASENAME=`echo $@ | sed -e 's/_example//'` ;\
	DFLAG=`echo $${BASENAME} | sed -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`;\
	DFLAG=p7$${DFLAG}_EXAMPLE ;\
	DFILE=$${BASENAME}.c ;\
	${CC} ${CFLAGS} ${SIMDFLAGS} ${CPPFLAGS} ${LDFLAGS} ${DEFS} ${MYLIBDIRS} ${MYINCDIRS} -D$${DFLAG} -o $@ $${DFILE} ${MYLIBS}

../libhmmer.a:  ${HDRS} ${OBJS}
	cd ..; ${MAKE} libhmmer.a

../../easel/libeasel.a:
	cd ../../easel/; ${MAKE} libeasel.a

.c.o:
	${CC} ${CFLAGS} ${SIMDFLAGS} ${CPPFLAGS} ${DEFS} ${PTHREAD_CFLAGS} ${MYINCDIRS} -c $<


distclean:
	make clean
	-rm -f Makefile 

clean:
	-rm -f ${UTESTS}
	-rm -f ${BENCHMARKS}
	-rm -f ${EXAMPLES}
	-rm -f *.o *~ Makefile.bak core TAGS gmon.out 
	-rm -f *.gcno

binclean:
	-rm -f *.o *~ Makefile.bak core TAGS gmon.out 

tags:
	etags  *.c *.h Makefile.in

###########
# @LICENSE@
###########
